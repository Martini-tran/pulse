apiVersion: v1
kind: ConfigMap
metadata:
  name: pulse-config
  namespace: pulse
data:
  application.yml: |
    spring:
      profiles:
        active: k8s
      datasource:
        url: jdbc:mysql://mysql-service:3306/pulse?useUnicode=true&characterEncoding=utf8&serverTimezone=GMT%2B8
        username: pulse
        password: ${MYSQL_PASSWORD}
        driver-class-name: com.mysql.cj.jdbc.Driver
        hikari:
          minimum-idle: 5
          maximum-pool-size: 20
          idle-timeout: 300000
          connection-timeout: 20000
      redis:
        host: redis-service
        port: 6379
        password: ${REDIS_PASSWORD}
        timeout: 2000ms
        lettuce:
          pool:
            max-active: 20
            max-idle: 10
            min-idle: 5
      cache:
        type: redis
        redis:
          time-to-live: 3600000
    
    # MyBatis配置
    mybatis:
      mapper-locations: classpath*:mapper/**/*.xml
      type-aliases-package: com.tran.pulse.*.domain
      configuration:
        map-underscore-to-camel-case: true
        cache-enabled: true
        lazy-loading-enabled: true
        multiple-result-sets-enabled: true
    
    # 分页插件配置
    pagehelper:
      helper-dialect: mysql
      reasonable: true
      support-methods-arguments: true
      params: count=countSql
    
    # 日志配置
    logging:
      level:
        com.tran.pulse: INFO
        org.springframework.web: WARN
        org.mybatis: WARN
      pattern:
        console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
        file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
      file:
        name: /app/logs/pulse.log
        max-size: 100MB
        max-history: 30
    
    # 管理端点配置
    management:
      endpoints:
        web:
          exposure:
            include: health,info,metrics,prometheus
      endpoint:
        health:
          show-details: when-authorized
      metrics:
        export:
          prometheus:
            enabled: true