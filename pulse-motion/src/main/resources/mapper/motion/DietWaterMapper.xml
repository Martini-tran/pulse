<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.tran.pulse.motion.diet.mapper.DietWaterMapper">

    <!-- 通用结果映射 -->
    <resultMap id="DietWaterResultMap" type="com.tran.pulse.common.domain.entity.DietWater">
        <id property="id" column="id"/>
        <result property="userId" column="user_id"/>
        <result property="recordDate" column="record_date"/>
        <result property="intakeMl" column="intake_ml"/>
        <result property="createdTime" column="created_time"/>
        <result property="updatedTime" column="updated_time"/>
    </resultMap>

    <!-- 查询指定用户在时间范围内的饮水记录 -->
    <select id="selectDietWater" resultMap="DietWaterResultMap">
        SELECT id, user_id, record_date, intake_ml, created_time, updated_time
        FROM diet_water
        WHERE user_id = #{userId}
          AND record_date BETWEEN #{startDate} AND #{endDate}
        ORDER BY record_date ASC
    </select>

    <!-- 插入饮水记录 -->
    <insert id="insertDietWater" parameterType="com.tran.pulse.common.domain.entity.DietWater" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO diet_water (user_id, record_date, intake_ml)
        VALUES (#{userId}, #{recordDate}, #{intakeMl})
    </insert>


    <!-- 更新饮水记录 -->
    <update id="updateDietWater" parameterType="com.tran.pulse.common.domain.entity.DietWater">
        UPDATE diet_water
        SET intake_ml = #{intakeMl},
            updated_time = CURRENT_TIMESTAMP
        WHERE id = #{id}
    </update>

    <!-- 根据主键删除饮水记录 -->
    <delete id="deleteDietWater">
        DELETE FROM diet_water WHERE id = #{dietWaterId}
    </delete>

    <delete id="deleteDietWaterByUserIdAndDate">
        DELETE FROM diet_water WHERE user_id = #{userId} and record_date = #{recordDate}
    </delete>

    <!-- 根据用户ID查询饮水记录 -->
    <select id="selectDietWaterByUserId" resultMap="DietWaterResultMap">
        SELECT id, user_id, record_date, intake_ml, created_time, updated_time
        FROM diet_water
        WHERE user_id = #{userId}
        ORDER BY record_date ASC
    </select>

</mapper>
