<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tran.pulse.motion.tag.mapper.TagHistoryMapper">

    <resultMap id="TagHistoryResultMap" type="com.tran.pulse.common.domain.entity.TagHistory">
        <id column="id" property="id"/>
        <result column="tag_code" property="tagCode"/>
        <result column="user_id" property="userId"/>
        <result column="tag_value" property="tagValue"/>
        <result column="record_time" property="recordTime"/>
        <result column="created_time" property="createdTime"/>
        <result column="updated_time" property="updatedTime"/>
    </resultMap>
    <delete id="delete">
        DELETE FROM tag_history
        WHERE id = #{id}
    </delete>

    <select id="getHistoryByUserIdAndTimeRange" resultMap="TagHistoryResultMap">
        SELECT id, tag_code, user_id, tag_value, record_time, created_time, updated_time
        FROM tag_history
        WHERE user_id = #{userId}
        <if test="startTime != null">
            AND record_time >= #{startTime}
        </if>
        <if test="endTime != null">
            AND record_time &lt;= #{endTime}
        </if>
        ORDER BY record_time DESC
    </select>

    <select id="getTagHistory" resultType="com.tran.pulse.common.domain.entity.TagHistory">
        SELECT id, tag_code, user_id, tag_value, record_time, created_time, updated_time
        FROM tag_history
        <where>
            <if test="id != null">
                AND id = #{id}
            </if>
            <if test="tagCode != null and tagCode != ''">
                AND tag_code = #{tagCode}
            </if>
            <if test="userId != null">
                AND user_id = #{userId}
            </if>
            <if test="tagValue != null and tagValue != ''">
                AND tag_value = #{tagValue}
            </if>
            <if test="recordTime != null and recordTime != ''">
                AND record_time = #{recordTime}
            </if>
            <if test="createdTime != null">
                AND created_time = #{createdTime}
            </if>
            <if test="updatedTime != null">
                AND updated_time = #{updatedTime}
            </if>
        </where>
        ORDER BY record_time DESC, id DESC
    </select>
    <select id="getHistoryByDateAndCode" resultMap="TagHistoryResultMap">
        SELECT id, tag_code, user_id, tag_value, record_time, created_time, updated_time
        FROM tag_history
        <where>
            <if test="startTime != null">
                AND record_time &gt;= #{startTime}
            </if>
            <if test="endTime != null">
                AND record_time &lt;= #{endTime}
            </if>
            <if test="tagCode != null and tagCode != ''">
                AND tag_code = #{tagCode}
            </if>
            <if test="userId != null and userId != ''">
                AND user_id = #{userId}
            </if>
        </where>
        ORDER by record_time asc
    </select>



    <insert id="batchInsert" parameterType="map">
        INSERT INTO tag_history (tag_code, user_id, tag_value, record_time, created_time, updated_time)
        VALUES
        <foreach collection="tagHistories" item="tagHistory" separator=",">
            (#{tagHistory.tagCode}, #{tagHistory.userId}, #{tagHistory.tagValue}, 
             #{tagHistory.recordTime}, #{tagHistory.createdTime}, #{tagHistory.updatedTime})
        </foreach>
    </insert>

    <insert id="insert" parameterType="com.tran.pulse.common.domain.entity.TagHistory" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO tag_history (tag_code, user_id, tag_value, record_time, created_time, updated_time)
        VALUES (#{tagCode}, #{userId}, #{tagValue}, #{recordTime}, #{createdTime}, #{updatedTime})
    </insert>



    <update id="update" parameterType="com.tran.pulse.common.domain.entity.TagHistory">
        UPDATE tag_history
        SET tag_code = #{tagCode},
            user_id = #{userId},
            tag_value = #{tagValue},
            record_time = #{recordTime},
            updated_time = #{updatedTime}
        WHERE id = #{id}
    </update>



</mapper>
